{% extends "layout.twig" %}

{% block title %}ABGYhuDJ | Admin Dashboard{% endblock %}

{% block content %}
  <a class="deco" href="/logout">Déconnexion</a>
  <h2 class="gros-titre">GESTION ADMINISTRATEUR</h2>
  <div class="gestion-stock">
    <div class="gstock-body">
      <label for="villeSelect" class="form-label">Ville / Concert</label>
        <select id="villeSelect" class="form-select">
        <option value="" selected disabled>— choisir —</option>
        {% for c in concerts %}
            <option value="{{ c.id }}" data-stock="{{ c.placesDispo }}">
            {{ c.ville }} — {{ c.date|date('Y-m-d') }}
            </option>
        {% endfor %}
        </select>

        <div class="stock-num">
            <label for="stockInput" class="form-label">Places disponibles</label>
            <input id="stockInput" type="number" min="0" class="form-control" placeholder="—" disabled>
        </div>

        <div class="stock-btn">
            <button id="saveBtn" disabled>Enregistrer</button>
            <span id="info" class="text-muted"></span>
        </div>  
    </div>
  </div>
  {% if created %}
    <div class="alert-success">Concert créé ✅</div>
  {% endif %}
  {% if error %}
    <div class="alert-error">Erreur : {{ error }}</div>
  {% endif %}
  <details class="panel-add" {% if flash.err %}open{% endif %}>
    <summary class="ajout">+ Ajouter un concert</summary>
    <form action="/admin/api/concerts" method="post" enctype="multipart/form-data" class="admin-form">
      {# Si tu actives csurf, ajoute ici le token : <input type="hidden" name="_csrf" value="{{ csrfToken }}"> #}

      <div class="row">
        <label>Ville *</label>
        <input type="text" name="ville" required placeholder="Paris">
      </div>
      <div class="row two">
        <div>
          <label>Date *</label>
          <input type="date" name="date" required>
        </div>
        <div>
          <label>Heure *</label>
          <input type="time" name="heure" required>
        </div>
      </div>
      <div class="row">
        <label>Lieu *</label>
        <input type="text" name="lieu" required placeholder="Accor Arena">
      </div>
      <div class="row two">
        <div>
          <label>Places disponibles</label>
          <input type="number" name="placesDispo" min="0" value="0">
        </div>
        <div>
          <label>Image (optionnel)</label>
          <input type="file" name="image" accept="image/png, image/jpeg, image/webp" id="img-input">
        </div>
      </div>
      <div class="row two">
        <div>
          <label>Prix debout (€)</label>
          <input type="number" name="prixDebout" min="0" step="0.01">
        </div>
        <div>
          <label>Prix assis (€)</label>
          <input type="number" name="prixAssis" min="0" step="0.01">
        </div>
      </div>
      <button type="submit" id="btn-create">Créer</button>
    </form>
  </details>
  <h3 class="second-title" style="margin-top:2rem;">Concerts existants</h3>
  <div class="admin-table">
      {% for c in concerts %}
        <p>{{ c.ville }} - {{ c.dateLabel }} - {{ c.lieu }}</p>
      {% else %}
        <p>Aucun concert</p>
      {% endfor %}
  </div>
  <script src="/public/scripts/script-admin.js"></script>

{% endblock %}
